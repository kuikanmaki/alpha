<% provide(:title, @page.name) %>

<div class="row" style="margin-bottom:10px;">
  <div class="col-md-9">
    <h3><%= @page.name %></h3>

    <% if @page.definition.present? %>
        <p><%= @page.definition %>
          <% if current_user.present? %>
            (<%= link_to "Edit", edit_page_path(:id => @page.id) %>)</p>
          <% end %>
        </p>  
    <% else %>
      <% if current_user.present? %>
        <p><%= link_to "Describe " + @page.name, edit_page_path(:id => @page.id, :type => "definition")  %></p>
      <% end %>
    <% end %>      

    <% if current_user.present? %>
      <p></p>
    <% end %>  

  </div>

  <div class="col-md-2 col-md-offset-1 col-lg-offset-1" style="text-align:right">
  <% if current_user.present? && !@follower %>       
      <%= button_to 'Add to Interests', follow_page_path(@page.id), :class => "btn btn-xs btn-inverse" %>
      <% elsif current_user.present? %>
      <%= button_to 'Unfollow', unfollow_page_path(@page.id), :class => "btn btn-xs btn-default" %>      
  <% end %>

  <% if current_user.present? && current_user.admin %> 
    <%= link_to 'Delete Page', page_path, :confirm => 'Are you sure you want to delete this page?', :method => :delete %>   
  <% end %>

  </div>
</div>

<hr>

<% if current_user.present? %> 
  <div class="row">
    <div class="col-md-6 col-md">
    <h4>Notes</h4>              
          <%= link_to "Add Notes", new_note_path(:id => @page.id), :class => "btn btn-xs btn-link" %>
          <%= link_to "Add Books", new_book_path(:id => @page.id), :class => "btn btn-xs btn-link" %>
    </div>
  </div>
<% end %> 

<div class="row">
  <div class="col-md-10 col-md"> 
    <% if @notes.any? %>
      <div class="row">
        <%= render @notes %>
          <%= will_paginate @notes %>
       </div>   
    <% else %>
      <div class="col-md-10 emptypage">
        <h5>No Notes yet...</h5>
          <p>Be the first one to write Notes to <%= @page.name %></p>
<% if !current_user.present? %>  
 <%= link_to "Sign in", signin_path %>
<% end %>        
      </div>     
    <% end %>
    <% if @books.any? %>  
        <h5>Books</h5>
        <p><br> <% @books.each do |book| %>
        <span class="glyphicon icon-book"></span> <%= book.author %> - <i><%= link_to book.name, book %></i></p>
        <% end %>
      <% end %>
  </div>
</div>  

<div class="row">
  <div class="col-md-10 col-md">
    <div class="navigationbar">

     <% if @subpages.any? %> 
     <h5>Subpages
      </h5>
        <table style="margin-bottom:3px;">
          <tr>
            <% @subpages.each do |subpage| %>
              <tr>
                <td style="padding-top:1px;padding-right:10px;"><%= link_to (image_tag subpage.image.url(:thumb), :size => "20x20"), subpage %></td>
                <td><%= link_to subpage.name, page_path(:id => subpage.id) %> </td>
              </tr>
              <% end %>
        </table>
        <% if current_user.present? %> 
          <%= link_to "+", new_page_path(:id => @page.id, :status => "subpage"), :class => "btn btn-xs btn-default" %>
        <% end %>  
      <% else %> 
      <% if current_user.present? %>
        <h5>Subpages (Add)
          <br><br><%= link_to "+", new_page_path(:id => @page.id, :status => "subpage"), :class => "btn btn-xs btn-default" %>
          <br><br>
      <% else %>
      <p>No Subpages<br></p>
      <% end %>
      </h5>        
    <% end %>
    <% if @relatedpages.any? %> 
        <h5>Related Pages
      </h5>    
        <table style="margin-bottom:3px;">
          <tr>
            <% @relatedpages.each do |relatedpage| %>
              <tr>
                <td style="padding-top:1px;padding-right:10px;"><%= link_to (image_tag relatedpage.image.url(:thumb), :size => "20x20"), relatedpage %></td>
                <td><%= link_to relatedpage.name, page_path(:id => relatedpage.id, :backlink => @page.name) %> </td>
              </tr>
            <% end %>
         </table>
         <% if current_user.present? %> 
           <%= link_to "+", new_page_path(:id => @page.id, :status => "relatedpage"), :class => "btn btn-xs btn-default" %>
         <% end %>
    <% else %> 
      <% if current_user.present? %>
        <h5>Related Pages (Add)
          <br><br><%= link_to "+", new_page_path(:id => @page.id, :status => "relatedpage"), :class => "btn btn-xs btn-default" %>
          <br><br>      
      <% else %>
      <p>No Related Pages</p>
      <% end %>
      </h5> 
    <% end %>
    </div>  
  </div>        
</div> 

<% if current_user.nil? %>
  <div class="row">
    <div class="col-md-4 col-md" style="padding:10px;">
      To edit this Page you have to be <%= link_to "Signed in", signin_path %>
    </div>
  </div>
<% end %>      